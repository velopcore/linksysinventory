<!-- FULL UPDATED FRONTEND CODE WITH CORRECT syncAdd / syncUpdate / syncDelete APPLIED -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Linksys Inventory System (Google Sync)</title>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:12px; color:#111; background:#f7f8fb; }
  header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
  h1 { font-size:18px; margin:0; }
  .login-box, .app { border:1px solid #ddd; border-radius:8px; padding:12px; max-width:1100px; margin:0 auto; background:#fff; box-shadow:0 1px 6px rgba(0,0,0,0.04); }
  .container { display:flex; gap:12px; }
  .left { flex:2; padding:10px; border:1px solid #eee; border-radius:6px; background:#fff; }
  .right { flex:1; padding:10px; border:1px solid #eee; border-radius:6px; background:#fff; }
  .bottom, .activity { margin-top:12px; padding:8px; border:1px solid #eee; border-radius:6px; background:#fff; }
  label { display:block; font-weight:600; margin-top:8px; font-size:13px; }
  input[type="text"], input[type="password"], input[type="file"], select { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; font-size:13px; }
  button { padding:8px 12px; margin-top:8px; border-radius:6px; border:1px solid #aaa; background:#f6f6f6; cursor:pointer; font-size:13px; }
  button.primary { background:#0366d6; color:#fff; border-color:#0366d6; }
  button.warn { background:#ffefef; color:#a10000; border-color:#f5c2c2; }
  .small { font-size:12px; color:#666; margin-top:6px; }
  table { width:100%; border-collapse:collapse; margin-top:8px; font-size:13px; background:#fff; }
  th, td { border:1px solid #e6e6e6; padding:6px; text-align:left; vertical-align:top; }
  th { background:#fafafa; font-weight:700; }
  tr.clickable:hover { background:#f5fbff; cursor:pointer; }
  .msg { padding:8px; border-radius:6px; background:#eef7ee; border:1px solid #d5ecd6; color:#1a5b2a; margin-top:8px; }
  .hidden { display:none; }
</style>
</head>
<body>

<div class="login-box" id="loginBox">
  <h1>üîê Linksys Inventory ‚Äî Login</h1>
  <div style="max-width:480px;margin-top:12px;">
    <label>Username</label>
    <input type="text" id="loginUser" autocomplete="username">
    <label>Password</label>
    <input type="password" id="loginPass" autocomplete="current-password">
    <div style="margin-top:10px;">
      <button id="btnLogin" class="primary">Login</button>
    </div>
    <div class="small">Users: admin / edmar / van / viewer</div>
    <div id="loginMsg" class="msg hidden"></div>
  </div>
</div>

<div class="app hidden" id="app">
  <header>
    <div><strong>Linksys Inventory System</strong></div>
    <div>
      <span id="userInfo" class="small"></span> | <a href="#" id="btnLogout">Logout</a>
    </div>
  </header>

  <div class="container">
    <div class="left">
      <h3>üßæ Item Details</h3>
      <label>Brand</label><input type="text" id="fBrand" class="upper">
      <label>Model Number</label><input type="text" id="fModel" class="upper">
      <label>Serial Number</label><input type="text" id="fSerial" class="upper">
      <label>Date Received</label><input type="text" id="fDate" placeholder="MM/DD/YYYY">
      <label>Location</label><input type="text" id="fLocation" class="upper">
      <label>Tracking Number</label><input type="text" id="fTracking" class="upper">
      <label>Remarks</label><input type="text" id="fRemarks" class="upper">
      <button id="btnClearForm">Clear Item Details</button>
    </div>

    <div class="right">
      <h3>‚öôÔ∏è Actions</h3>
      <button id="btnAdd" class="primary">Add Item</button>
      <button id="btnSave">Save Changes</button>
      <button id="btnRemove" class="warn">Remove Item</button>
      <hr>
      <label>Import/Export</label>
      <input type="file" id="fileImport" accept=".csv">
      <div style="display:flex; gap:8px;">
        <button id="btnImport">Import</button>
        <button id="btnExport">Export</button>
      </div>
      <hr>
      <label>Search</label>
      <input type="text" id="searchBox" placeholder="keyword...">
      <div style="display:flex; gap:8px;">
        <button id="btnSearch">Search</button>
        <button id="btnShowAll">Show All</button>
        <button id="btnClearSearch">Clear Search</button>
      </div>
      <button id="btnDownloadTemplate">Download CSV Template</button>
      <div id="actionMsg" class="msg hidden"></div>
    </div>
  </div>

  <div class="bottom">
    <div style="display:flex; justify-content:space-between;">
      <h3>üìã Inventory Table</h3>
      <span class="small">Last Action: <span id="lastAction">‚Äî</span></span>
    </div>
    <table id="invTable">
      <thead><tr id="theadRow"></tr></thead>
      <tbody id="tbodyRows"></tbody>
    </table>
  </div>

  <div class="activity hidden" id="activityLogBox">
    <h3>üïì Activity Log</h3>
    <table id="activityTable"><thead><tr><th>User</th><th>Role</th><th>Action</th><th>Timestamp</th></tr></thead><tbody id="activityBody"></tbody></table>
  </div>
</div>

<script>
// ---------------------------------------------------------
// CONFIG
// ---------------------------------------------------------
const FIELDS=['Brand','Model Number','Serial Number','Date Received','Location','Tracking Number','Remarks'];
const STORAGE_KEY='linksys_inventory_v1',USER_KEY='linksys_current_user',LOG_KEY='linksys_activity_log';
const SHEET_URL="https://script.google.com/macros/s/AKfycbwHoZFN9Dhkl0nlPQXW_bRdppdA38JPONoj9UC6Z_FyIuyBmxwD0tXju8o0z23B6oRn/exec";

const USERS={
  admin:{password:'admin123',role:'admin'},
  edmar:{password:'Asdfg12345!',role:'staff'},
  van:{password:'P1nkR@nger!',role:'staff'},
  viewer:{password:'ViewOnly',role:'viewer'}
};

let inventory=[],activityLog=[],currentUser=null,selectedIndex=-1;
function el(x){return document.getElementById(x);} function show(x){x.classList.remove('hidden');} function hide(x){x.classList.add('hidden');}
function now(){return new Date().toLocaleString();}

// ---------------------------------------------------------
// NEW GOOGLE SYNC FUNCTIONS (REQUIRED)
// ---------------------------------------------------------

// ADD (append row)
async function syncAdd(record){
  try{
    await fetch(SHEET_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({...record,Type:"add"})
    });
  }catch(e){console.error("syncAdd",e);}
}

// UPDATE (replace row contents)
async function syncUpdate(record,rowIndex){
  try{
    await fetch(SHEET_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({...record,RowIndex:rowIndex,Type:"update"})
    });
  }catch(e){console.error("syncUpdate",e);}
}

// DELETE (client-side password + server delete)
async function syncDelete(rowIndex){
  const pw=prompt("Enter admin password to delete:");
  if(!pw) return false;
  if(pw!=="admin123"){alert("Incorrect password.");return false;}

  try{
    await fetch(SHEET_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({RowIndex:rowIndex,Password:pw,Type:"delete"})
    });
  }catch(e){console.error("syncDelete",e);alert("Delete request failed.");return false;}

  return true;
}

// ---------------------------------------------------------
// LOGGING
// ---------------------------------------------------------
function loadLogs(){try{activityLog=JSON.parse(localStorage.getItem(LOG_KEY))||[]}catch{activityLog=[];}}
function saveLogs(){localStorage.setItem(LOG_KEY,JSON.stringify(activityLog));}

function logAction(a){
  if(!currentUser)return;
  const e={user:currentUser.username,role:currentUser.role,action:a,time:now()};
  activityLog.push(e);
  saveLogs();
  el('lastAction').textContent=`${e.user} ${e.action} at ${e.time}`;
  if(currentUser.role==='admin')buildActivity();

  // SYNC log
  try{
